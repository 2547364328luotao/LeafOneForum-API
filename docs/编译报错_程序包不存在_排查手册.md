# Java 编译报错「程序包 xyz.luotao.v1.entity.dto 不存在」排查手册

适用场景：在编译 `OnlineController.java`（或其他类）时，出现类似

```
...\OnlineController.java:9:32
java: 程序包 xyz.luotao.v1.entity.dto 不存在
```

## 本项目的实际情况（已核对）
- 源码中确实存在这些 DTO：
  - `src/main/java/xyz/luotao/v1/entity/dto/HeartbeatRequest.java`
  - `src/main/java/xyz/luotao/v1/entity/dto/HeartbeatResponse.java`
  - `src/main/java/xyz/luotao/v1/entity/dto/CountResponse.java`
- 以上文件包声明均为：`package xyz.luotao.v1.entity.dto;`，与目录结构匹配。
- 因此，错误通常不是“文件缺失/包名错误”，而是“编译方式/IDE 配置问题”。

## 高频根因与对应解决

1) 仅编译了单个文件（没有把整个源码路径传给编译器）
- 现象：手动用 `javac OnlineController.java` 或 IDE 仅对某个文件做“局部编译”，会报找不到其他包。
- 解决：始终用构建工具全量编译，或配置正确的 sourcepath/classpath。
  - 推荐：在项目根目录执行
    ```bash
    # Windows
    .\mvnw.cmd -q clean package
    # 或
    mvn -q clean package
    ```
  - 如果必须用 `javac`，请保证包含完整的 `-sourcepath` 与依赖 `-cp`（不推荐）。

2) IDE 没有把 `src/main/java` 标记为 Sources 根目录
- 现象：IDE 认为这些 Java 文件不在源码根中，导致“包不存在”。
- 解决：
  - IntelliJ IDEA：File -> Project Structure -> Modules -> Sources，确认 `src/main/java` 为 blue（Sources）。
  - Eclipse：右键项目 -> Properties -> Java Build Path -> Source，确保包含 `src/main/java`。

3) IDE 缓存/索引异常
- 现象：明明文件在，IDE 仍提示包不存在。
- 解决：
  - IntelliJ IDEA：File -> Invalidate Caches... -> Invalidate and Restart。
  - Eclipse：Project -> Clean...，并执行 Maven -> Update Project。

4) 构建未使用 Maven（或 Maven 项目未刷新）
- 解决：
  - 右键导入为 Maven 项目（Import Project from Existing Sources -> Maven）。
  - 在 IDE 中 Reimport/Reload Maven（IntelliJ 右侧 Maven 工具栏点击刷新）。
  - 打开“Delegate IDE build/run to Maven/Gradle”（IDEA：Settings -> Build Tools -> Maven/Runner）。

5) JDK 或 Lombok 配置不当
- 解决：
  - 确认 JDK 版本为 17（本项目 `pom.xml` 指定 `<java.version>17</java.version>`）。
  - IDEA 安装 Lombok 插件，并开启注解处理（Settings -> Build -> Compiler -> Annotation Processors -> Enable）。
  - Maven 会自动处理 Lombok 编译，无需插件，但 IDE 没有插件会导致提示红线（不影响 Maven 编译）。

6) 大小写/路径不一致（Linux 常见）
- 解决：确保目录名与包名大小写完全一致：`xyz/luotao/v1/entity/dto`。

## 一键自查清单（建议顺序）
- [ ] 在项目根执行一次全量构建：
  ```bash
  .\mvnw.cmd -q clean package
  ```
  - 构建成功后，应在 `target/classes/xyz/luotao/v1/entity/dto/` 看到编译产物。
- [ ] IDE 中确认 `src/main/java` 已标记为 Sources。
- [ ] 重新导入/刷新 Maven 项目；必要时清理 IDE 缓存并重启。
- [ ] 确认 JDK 版本为 17；Lombok 插件已启用并开启注解处理。

## 参考：快速验证
- 运行：
  ```bash
  .\mvnw.cmd -q spring-boot:run
  ```
- 验证接口（可用 Postman 或 curl）：
  - 心跳：POST http://localhost:8080/public/online/heartbeat
  - 统计：GET  http://localhost:8080/public/online/count?timeoutSec=60

## FAQ
- Q: Maven 构建成功，但 IDE 仍报错？
  - A: 多半是 IDE 索引问题或未开启 Lombok 注解处理，不影响运行；按上面第 2-3 步修复。
- Q: 仍然报“包不存在”？
  - A: 核对你执行编译/运行的当前工作目录是否为项目根；避免在 `src` 子目录直接运行。

---
文档位置：`docs/编译报错_程序包不存在_排查手册.md`。建议在 IDE 打开此文件，按清单逐项排查。
